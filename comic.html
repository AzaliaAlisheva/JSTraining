<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Azalia's App</title>
    <script defer>
        function fetchId(email) {
            const params = new URLSearchParams();
            if (email) {
                params.append('email', email);
            }
            return fetch('https://fwd.innopolis.university/api/hw2?' + params.toString()).then(r => r.json());
        }

        function fetchInfo(id) {
            const params = new URLSearchParams();
            if (id) {
                params.append('id', id);
            }
            return fetch('https://fwd.innopolis.university/api/comic?' + params.toString()).then(r => r.json());
        }

        function createImg(src, alt) {
            const img = document.createElement("img");
            img.src = src;
            img.alt = alt;
            return img;
        }

        function createDate(day, month, year) {
            day = parseInt(day);
            month = parseInt(month);
            year = parseInt(year);
            const event = new Date(Date.UTC(year, month - 1, day));
            const options = {
                day: 'numeric',
                month: 'numeric',
                year: 'numeric',
            };
            const date = document.createElement('h4');
            date.textContent = event.toLocaleDateString(undefined, options);
            return date;
        }

        async function display() {
            const id = await fetchId('a.alisheva@innopolis.university');
            const info = await fetchInfo(id);
            console.log(info);
            const comic = document.getElementById('comic');
            comic.insertBefore(createImg(info.img, info.alt), comic.firstChild);

            const displayedInfo = document.getElementById('imgInfo');
            displayedInfo.textContent = info.safe_title;
            displayedInfo.style.fontWeight = "bold";
            displayedInfo.appendChild(createDate(info.day, info.month, info.year));
        }

        display();
    </script>
</head>
<body>
    <header class="full"><a href="./labs.html"><img src="./img/white_back_arrow.png" class="headericon"></a></header>
    <main class="full" id="comic">
        <div id="imgInfo">Loading...</div>
    </main>
</body>
</html>